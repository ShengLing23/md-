# 什么是事务

​	事务中的操作，要么全部成功，要么全部失败

## 事务的ACID特性

* 原子性（Atomicity）:组成一个事务的多个数据库操作是一个不可分割的原子单元，只有所有操作全部执行成功，整个事务才能提交，事务中的任何一个操作失败，已经执行的任何操作必须撤销，让数据库退回初始状态。
* 一致性（Consistency）:事务将数据库从一种状态变为下一种一致性的状态。事务开始前和事务结束后，数据库的完整性约束没有被破坏。
* 隔离性（isolation）：不同的事务用有各自的数据空间，他们的操作不会对对方产生干扰。
* 持久性（Durability）：事务一旦提交，其结果就是永久性的。即使发生宕机等故障，数据库也能将数据恢复。

## 数据并发问题

​	数据库中的相同数据可能同时被多个事务访问，如果没有采取必要的隔离措施，会导致各种并发问题，破坏数据的完整性。

### 脏读（dirty read）

​	A事务读取到了B事务尚未提交的更改数据。违反了数据库的隔离性。

### 不可重复读

​	一个事务内多次读取同一数据集合，在这个事务还没有结束时，另一个事务也访问该同一数据集合，并做一些修改。因此，在第一个事务中的两次读数据之间，两次读取到的数据可能是不一样的。	

​	A事务读取到了B事务已经提交的更改数据。

不可重复读和脏读的区别：

* 脏读是读到未提交的数据，违反了数据库的隔离性要求
* 不可重复读是读取到了已经提交的数据，违反了数据库事务一致性的要求。

### 幻象读

​	A事务读取到了B事务提交的新增数据。这事A事务将出现幻象读的问题。

幻象读和不可重复读的区别：

* 幻象读是指读取到了其他已经提交事务的新增数据
* 不可重复读是读到了已经提交事务的更改数据（更改和删除）。

### 第一类丢失更新

​	A事务撤销时，把已经提交的B事务的更新数据覆盖了

### 第二类丢失更新

​	A事务覆盖B事务已经提交的数据，造成B事务所做的操作丢失

## 隔离级别

| 隔离级别         | 脏读 | 不可重复读 | 幻象读 | 第一类丢失更新 | 第二类丢失更新 |
| ---------------- | ---- | ---------- | ------ | -------------- | -------------- |
| read uncommited  | √    | √          | √      | x              | √              |
| read committed   | x    | √          | √      | x              | √              |
| repleatable read | x    | x          | √      | x              | x              |
| Serializable     | x    | x          | x      | x              | x              |

# 事务的实现

​	事务的隔离性由锁来实现。原子性，一致性，持久性通过数据库的redo log 和undo log来实现。

​	redo log来保证事务的原子性和持久性。undo log用来保证事务的一致性。

# spring中事务的实现

​	

# 分布式事务







































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































